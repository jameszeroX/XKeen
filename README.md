# Xray-Keenetic
Origin <https://github.com/Skrill0/XKeen>

FAQ <https://jameszero.net/faq-xkeen.htm>

Telegram <https://t.me/+SZWOjSlvYpdlNmMy> (обсуждение, инструкции по установке, советы по использованию)

Xray-core <https://github.com/XTLS/Xray-core>

Mihomo <https://github.com/MetaCubeX/mihomo>

> [!WARNING]
> Данный материал подготовлен в научно-технических целях. Утилита XKeen предназначена для защиты сети, автор не несёт ответственности за иное её использование 

> [!NOTE]
> Установка XKeen гарантируется только на внешние USB-накопители, при этом установка на внутреннюю память роутера возможна, но требует знаний и опыта пользователя. Если возникли трудности с установокой на внутренню память, не сообщайте об этом, как об ошибке в установщике. Проблема не в XKeen

## Версия 1.1.3.7

Сравнение форка с оригинальным XKeen

Изменения:
- Исправлено добавление портов в исключения (ранее команду `xkeen -ape` нужно было прерывать по ctrl+c)
- Исправлена совместная работа режима TProxy и socks5 (ранее Xkeen запускался в Mixed режиме, что приводило к неработоспособности прозрачного проксирования)
- Исправлен автозапуск XKeen при старте роутера (ранее XKeen иногда не запускался или запускался для всего устройства, а не только для своей политики - [FAQ п.12](https://jameszero.net/faq-xkeen.htm#12))
- Переработана логика загрузки XKeen, Xray, Mihomo и GeoFile из интернета, уменьшающая вероятность их повреждения
- Переработана логика применения правил iptables и ip6tables (ранее XKeen применял все правила, даже при не установленном компоненте IPv6)
- Переработана логика добавления и удаления портов проксирования и исключаемых портов
- Объединены задачи планировщика по обновлению GeoSite и GeoIP. В связи с этим упразднены параметры запуска `-ugs`, `-ugi`, `-ugsc`, `-ugic`, `-dgsc`, `-dgic`
- Параметр запуска `-ux` для обновления ядра Xray теперь поддерживает повышение/понижение версии
- Корректная деинсталляция xray-core (ранее пакет xray не удалялся при деинсталляции)
- Справка (`xkeen -h`) выровнена по табуляции и повышен контраст текста
- Косметические и функциональные правки скриптов
- Актуализация конфигурационных файлов xray-core

Добавлено:
- Возможность выбрать версию Xray при установке XKeen
- Поддержка ядра Mihomo в режиме TProxy
- Возможность [OffLine установки](https://github.com/jameszeroX/XKeen/blob/main/OffLine_install.md) (параметр `-io`)
- Возможность установки GeoIP базы [zkeenip.dat](https://github.com/jameszeroX/zkeen-ip)
- Обновление [zkeen.dat](https://github.com/jameszeroX/zkeen-domains) и [zkeenip.dat](https://github.com/jameszeroX/zkeen-ip) по расписанию средствами XKeen
- Резервный источник релизов для XKeen, Xray и Mihomo на случай недоступности GitHub API
- Параметр запуска `-remove` для полной деинсталляции XKeen (ранее деинсталляцию нужно было выполнять покомпонентно)
- Параметры запуска `-ug` (обновление геофайлов), `-ugc` (управление заданием Cron, обновляющим геофайлы), `-dgc` (удаление задания Cron, обновляющего геофайлы)
- Параметры запуска `-mihomo` и `-xray` для смены ядра прокси-клиента
- Параметр запуска `-um` для обновления/установки ядра Mihomo (поддерживается повышение/понижение версии)
- Параметр запуска `-dm` для деинсталляции ядра Mihomo
- Параметр запуска `-g`, позволяющий переустановить (добавить/удалить) геофайлы для Xray
- Возможность контролировать число открытых файловых дескрипторов, используемых процессом xray и перезапускать процесс при исчерпании лимита. По умолчанию контроль отключен (включить/отключить можно запуском `xkeen -fd`), [подробнее](https://github.com/jameszeroX/XKeen/blob/main/FileDescriptors.md)

Удалено:
- Возможность установки GeoSite Antizapret (база повреждена в репозитории)
- Конфигурационный файл transport.json (не используется новыми ядрами xray-core)
- Запрос на перезапись и сама перезапись конфигурационных файлов Xray, если они уже существуют на момент установки XKeen
- Cоздание резервных копий конфигурационных файлов Xray, так как теперь они не могут быть случайно перезаписаны. В связи с этим упразднены параметры запуска `-cb` и `-cbr`
- Создание резервных копий Xray, так как теперь можно интерактивно установить предыдущую версию ядра параметром `-ux`. В связи с этим упразднены параметры запуска `-xb` и `-xbr`
- Задачи планировщика по автообновлению XKeen/Xray. В связи с этим упразднены параметры запуска `-uac`, `-ukc`, `-uxc`, `-dac`, `-dkc` и `-dxc`
- Параметры запуска: `-x` (заменён на `-ux`), `-rk` (заменён на `-rrk`), `-rx` (заменён на `-rrx`), `-rc` (не актуален)

Все параметры запуска с их описанием доступны в справке по команде `xkeen -h`

### Порядок установки
```
opkg update && opkg upgrade && opkg install curl tar
curl -OL https://raw.githubusercontent.com/jameszeroX/XKeen/main/install.sh
chmod +x ./install.sh
./install.sh
```
Альтернативный вариант:
```
opkg update && opkg upgrade && opkg install curl tar
curl -OL https://github.com/jameszeroX/XKeen/releases/latest/download/xkeen.tar.gz
tar -xvzf xkeen.tar.gz -C /opt/sbin > /dev/null && rm xkeen.tar.gz
xkeen -i
```
Установка [OffLine](https://github.com/jameszeroX/XKeen/blob/main/OffLine_install.md)

### Поддержка
Желающие угостить меня пивом, такую возможность имеют)
- Монета USDT, сеть TRC20:
```
TB9dLwzNdLB6QeKV6w4FjCACSarePb32Dg
```
- Монета USDT, сеть TON:
```
UQDHmmyz0e1K07Wf7aTVtdmcGzCPfo4Pf7uBi_Id8TDI6Da6
```
[ЮMoney](https://yoomoney.ru/to/41001350776240)

[CloudTips](https://pay.cloudtips.ru/p/7edb30ec)